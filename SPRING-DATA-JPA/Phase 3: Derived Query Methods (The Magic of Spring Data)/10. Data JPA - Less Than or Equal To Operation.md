# üöÄ Spring Data JPA - Less Than or Equal To Operations (<=) 

---

## ü§î Introduction - Confusion Clear Karte Hain Bhai!

### Simple Explanation First üí°
Yaar, socho tumhare paas ek shopping website hai aur tum chahte ho ki **"500 rupees ya usse kam price ke saare products dikha do"**. Bas yahi kaam karta hai **Less Than or Equal To** operation in JPA! 

### Real-Life Analogy üõí
```
Real Life Example:
- Shopkeeper se: "Bhaiya, 500 rupees tak ke saare shirts dikhaiye"
- Database se: "SELECT * FROM products WHERE price <= 500"
```

### Technical Definition üìñ
Spring Data JPA mein hum comparison operations kar sakte hain jaise Less Than or Equal to using LessThanEqual keyword with query method and <= operator with JPQL and Native SQL query.

---

## üìù Key Terms/Concepts

| Term | Hindi Meaning | Technical Definition |
|------|---------------|---------------------|
| **LessThanEqual** | Kam ya barabar | Query method keyword for <= operation |
| **JPQL** | Java Persistence Query Language | Object-oriented query language |
| **Native Query** | Original SQL query | Direct SQL query to database |
| **@Query** | Custom query annotation | Spring annotation for custom queries |

### Visual Representation üìä
```
Data: [100, 200, 300, 400, 500, 600]
Query: amount <= 400
Result: [100, 200, 300, 400] ‚úÖ
Rejected: [500, 600] ‚ùå
```

---

## üíª Detailed Examples - Teen Tarike!

### 1Ô∏è‚É£ Query Method Approach (Sabse Easy!) 

```java
// Repository Interface
public interface OrderRepository extends JpaRepository<OrderDetail, Long> {
    // Magic keyword: LessThanEqual
    List<OrderDetail> findByAmountLessThanEqual(Double amount);
}

// Usage in Service
@Service
public class OrderService {
    @Autowired
    private OrderRepository orderRepo;
    
    public List<OrderDetail> getCheapOrders(Double maxAmount) {
        // Ye method automatically SQL generate karega!
        return orderRepo.findByAmountLessThanEqual(maxAmount);
    }
}
```

**Expected Output:**
```sql
-- Generated SQL by Spring Data JPA
SELECT od.id, od.amount, od.customer_id 
FROM order_detail od 
WHERE od.amount <= ?
```

### 2Ô∏è‚É£ JPQL Approach (Custom Query with Java Objects)

```java
public interface OrderRepository extends JpaRepository<OrderDetail, Long> {
    
    @Query("SELECT o FROM OrderDetail o WHERE o.amount <= :amount")
    List<OrderDetail> findOrdersWithAmountLessThanEqual(@Param("amount") Double amount);
}
```

**Step-by-step Explanation:**
1. `@Query` annotation use kiya custom query ke liye
2. `OrderDetail o` - yaha `o` is alias for OrderDetail entity
3. `:amount` - named parameter hai
4. `@Param("amount")` - parameter binding ke liye

### 3Ô∏è‚É£ Native SQL Approach (Pure SQL)

```java
public interface OrderRepository extends JpaRepository<OrderDetail, Long> {
    
    @Query(value = "SELECT * FROM order_detail WHERE amount <= :amount", 
           nativeQuery = true)
    List<OrderDetail> findOrdersWithNativeQuery(@Param("amount") Double amount);
}
```

---

## ‚úÖ‚ùå Rules aur Guidelines

### Rule 1: Method Naming Convention
‚úÖ **Correct:**
```java
findByAmountLessThanEqual(Double amount)
findByPriceLessThanEqual(BigDecimal price)
findBySalaryLessThanEqual(Long salary)
```

‚ùå **Wrong:**
```java
findByAmountLessEqual(Double amount) // ‚ùå Wrong keyword
findByAmountLE(Double amount) // ‚ùå Abbreviation not allowed
```

### Rule 2: Parameter Types
‚úÖ **Correct:**
```java
// Numeric types
List<Product> findByPriceLessThanEqual(Double price);
List<Employee> findByAgeLessThanEqual(Integer age);
List<Order> findByAmountLessThanEqual(BigDecimal amount);

// Date types
List<Order> findByCreatedDateLessThanEqual(LocalDate date);
```

‚ùå **Wrong:**
```java
// String comparison - doesn't make sense
List<Product> findByNameLessThanEqual(String name); // ‚ùå
```

### Rule 3: JPQL vs Native Query
‚úÖ **JPQL (Recommended):**
```java
@Query("SELECT o FROM OrderDetail o WHERE o.amount <= :amount")
// Works across different databases
```

‚úÖ **Native Query (When needed):**
```java
@Query(value = "SELECT * FROM order_detail WHERE amount <= ?1", nativeQuery = true)
// Database-specific features ke liye
```

---

## üåç Real-world Applications

### 1. E-commerce Price Filter üõçÔ∏è
```java
@Repository
public interface ProductRepository extends JpaRepository<Product, Long> {
    
    // Products under budget
    List<Product> findByPriceLessThanEqual(Double maxPrice);
    
    // Products with discount
    @Query("SELECT p FROM Product p WHERE p.discountPrice <= :budget")
    List<Product> findAffordableProducts(@Param("budget") Double budget);
}

// Service layer
@Service
public class ProductService {
    
    public List<Product> getProductsUnderBudget(Double budget) {
        return productRepo.findByPriceLessThanEqual(budget);
    }
}
```

### 2. Employee Management System üë•
```java
@Repository
public interface EmployeeRepository extends JpaRepository<Employee, Long> {
    
    // Junior employees (salary <= 50000)
    List<Employee> findBySalaryLessThanEqual(Double salary);
    
    // Employees by age group
    List<Employee> findByAgeLessThanEqual(Integer age);
    
    // Experience-based filtering
    @Query("SELECT e FROM Employee e WHERE e.experienceYears <= :years")
    List<Employee> findJuniorEmployees(@Param("years") Integer years);
}
```

### 3. Banking System üè¶
```java
@Repository
public interface TransactionRepository extends JpaRepository<Transaction, Long> {
    
    // Small transactions
    List<Transaction> findByAmountLessThanEqual(BigDecimal amount);
    
    // Daily spending limit check
    @Query(value = "SELECT * FROM transactions WHERE amount <= :limit AND DATE(created_date) = CURDATE()", 
           nativeQuery = true)
    List<Transaction> findTodayTransactionsUnderLimit(@Param("limit") BigDecimal limit);
}
```

---

## üÜö Comparison Table

| Approach | Pros ‚úÖ | Cons ‚ùå | Best For |
|----------|---------|---------|----------|
| **Query Method** | - Easy to write<br>- Type-safe<br>- Auto-completion | - Limited complexity<br>- Long method names | Simple queries |
| **JPQL** | - Object-oriented<br>- Database independent<br>- Complex queries | - Learning curve<br>- Runtime errors | Complex business logic |
| **Native SQL** | - Full SQL power<br>- Database-specific features<br>- Performance tuning | - Database dependent<br>- No type safety | Performance-critical queries |

---

## üéØ Interview Questions & Answers

### Q1: Query method aur @Query annotation mein kya difference hai?

**Answer:**
```java
// Query Method - Spring automatically generates SQL
List<Order> findByAmountLessThanEqual(Double amount);

// @Query - Custom SQL/JPQL likhte hain
@Query("SELECT o FROM Order o WHERE o.amount <= :amount")
List<Order> customMethod(@Param("amount") Double amount);
```

**Explanation:** Query method mein Spring Data JPA automatically SQL generate karta hai method name se. @Query mein hum khud SQL/JPQL likhte hain.

### Q2: nativeQuery = true kab use karna chahiye?

**Answer:**
```java
// Normal JPQL (Recommended)
@Query("SELECT o FROM OrderDetail o WHERE o.amount <= :amount")

// Native Query (Specific cases)
@Query(value = "SELECT * FROM order_detail WHERE amount <= :amount AND YEAR(created_date) = YEAR(NOW())", 
       nativeQuery = true)
```

**When to use Native:**
- Database-specific functions chahiye
- Complex joins aur subqueries
- Performance optimization ke liye

### Q3: Multiple conditions ke sath LessThanEqual kaise use karein?

**Answer:**
```java
// Method naming
List<Product> findByPriceLessThanEqualAndCategoryEquals(Double price, String category);

// JPQL
@Query("SELECT p FROM Product p WHERE p.price <= :price AND p.category = :category")
List<Product> findProductsByPriceAndCategory(@Param("price") Double price, 
                                           @Param("category") String category);
```

---

## üö´ Common Mistakes - Inse Bacho!

### Mistake 1: Wrong Method Naming
‚ùå **Wrong:**
```java
List<Order> findByAmountLessEqual(Double amount); // Missing "Than"
```

‚úÖ **Correct:**
```java
List<Order> findByAmountLessThanEqual(Double amount);
```

### Mistake 2: Parameter Mismatch
‚ùå **Wrong:**
```java
@Query("SELECT o FROM OrderDetail o WHERE o.amount <= :price") // parameter name mismatch
List<OrderDetail> findOrders(@Param("amount") Double amount);
```

‚úÖ **Correct:**
```java
@Query("SELECT o FROM OrderDetail o WHERE o.amount <= :amount")
List<OrderDetail> findOrders(@Param("amount") Double amount);
```

### Mistake 3: Null Parameter Handling
‚ùå **Wrong:**
```java
public List<Product> getProducts(Double maxPrice) {
    return productRepo.findByPriceLessThanEqual(maxPrice); // maxPrice can be null!
}
```

‚úÖ **Correct:**
```java
public List<Product> getProducts(Double maxPrice) {
    if (maxPrice == null) {
        return productRepo.findAll(); // or throw exception
    }
    return productRepo.findByPriceLessThanEqual(maxPrice);
}
```

---

## üèÜ Best Practices

### 1. Method Naming Standards
```java
// ‚úÖ Good naming
findByAmountLessThanEqual(Double amount)
findByPriceLessThanEqualAndCategoryEquals(Double price, String category)

// ‚úÖ Descriptive names for complex queries
@Query("SELECT p FROM Product p WHERE p.price <= :maxPrice AND p.inStock = true")
List<Product> findAvailableProductsUnderBudget(@Param("maxPrice") Double maxPrice);
```

### 2. Parameter Validation
```java
@Service
public class OrderService {
    
    public List<OrderDetail> getOrdersByMaxAmount(Double maxAmount) {
        // Input validation
        if (maxAmount == null || maxAmount < 0) {
            throw new IllegalArgumentException("Max amount must be positive");
        }
        
        return orderRepo.findByAmountLessThanEqual(maxAmount);
    }
}
```

### 3. Performance Tips
```java
// ‚úÖ Index your comparison columns
@Entity
@Table(indexes = @Index(columnList = "amount"))
public class OrderDetail {
    // ... fields
}

// ‚úÖ Use Pageable for large result sets
Page<OrderDetail> findByAmountLessThanEqual(Double amount, Pageable pageable);
```

### 4. Documentation
```java
/**
 * Finds all orders where amount is less than or equal to specified value
 * @param maxAmount Maximum amount (inclusive)
 * @return List of matching orders, empty list if none found
 * @throws IllegalArgumentException if maxAmount is null or negative
 */
List<OrderDetail> findByAmountLessThanEqual(Double maxAmount);
```

---

## üìã Complete Working Example

### Entity Class
```java
@Entity
@Data  // Lombok annotation
@Table(name = "order_detail")
public class OrderDetail {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(name = "customer_id")
    private Long customerId;
    
    @Column(name = "amount")
    private Double amount;
    
    @Column(name = "created_date")
    private LocalDate createdDate;
}
```

### Repository Interface
```java
@Repository
public interface OrderRepository extends JpaRepository<OrderDetail, Long> {
    
    // Method 1: Query method
    List<OrderDetail> findByAmountLessThanEqual(Double amount);
    
    // Method 2: JPQL
    @Query("SELECT o FROM OrderDetail o WHERE o.amount <= :amount")
    List<OrderDetail> findOrdersWithAmountLTE(@Param("amount") Double amount);
    
    // Method 3: Native query
    @Query(value = "SELECT * FROM order_detail WHERE amount <= :amount", 
           nativeQuery = true)
    List<OrderDetail> findOrdersNative(@Param("amount") Double amount);
    
    // Method 4: With pagination
    Page<OrderDetail> findByAmountLessThanEqual(Double amount, Pageable pageable);
}
```

### Service Layer
```java
@Service
@Transactional(readOnly = true)
public class OrderService {
    
    @Autowired
    private OrderRepository orderRepository;
    
    public List<OrderDetail> getAffordableOrders(Double budget) {
        validateBudget(budget);
        return orderRepository.findByAmountLessThanEqual(budget);
    }
    
    public Page<OrderDetail> getAffordableOrdersPaged(Double budget, int page, int size) {
        validateBudget(budget);
        Pageable pageable = PageRequest.of(page, size);
        return orderRepository.findByAmountLessThanEqual(budget, pageable);
    }
    
    private void validateBudget(Double budget) {
        if (budget == null || budget < 0) {
            throw new IllegalArgumentException("Budget must be positive number");
        }
    }
}
```

### Controller
```java
@RestController
@RequestMapping("/api/orders")
public class OrderController {
    
    @Autowired
    private OrderService orderService;
    
    @GetMapping("/under-budget/{budget}")
    public ResponseEntity<List<OrderDetail>> getOrdersUnderBudget(
            @PathVariable Double budget) {
        
        try {
            List<OrderDetail> orders = orderService.getAffordableOrders(budget);
            return ResponseEntity.ok(orders);
        } catch (IllegalArgumentException e) {
            return ResponseEntity.badRequest().build();
        }
    }
    
    @GetMapping("/under-budget-paged/{budget}")
    public ResponseEntity<Page<OrderDetail>> getOrdersUnderBudgetPaged(
            @PathVariable Double budget,
            @RequestParam(defaultValue = "0") int page,
            @RequestParam(defaultValue = "10") int size) {
        
        Page<OrderDetail> orders = orderService.getAffordableOrdersPaged(budget, page, size);
        return ResponseEntity.ok(orders);
    }
}
```

---

## üß† Summary/Quick Recap

### Key Takeaways üéØ
1. **Teen methods hain:** Query Method, JPQL, Native SQL
2. **Query Method:** `findByFieldNameLessThanEqual(Type param)`
3. **JPQL:** `@Query` with `<=` operator
4. **Native:** `nativeQuery = true` with SQL

### Memory Tricks üß†
- **LTE = Less Than Equal** 
- **Parameter names match karna zaruri hai**
- **Null check karna mat bhulna**
- **Index lagana performance ke liye**

### When to Use What? ü§î

| Scenario | Best Choice |
|----------|-------------|
| Simple comparison | Query Method |
| Complex business logic | JPQL |
| Database-specific features | Native SQL |
| Large datasets | Pagination + Any method |

---

## üîó Testing APIs

### Sample Data
```json
[
    {"customerId": 1, "amount": 700.0},
    {"customerId": 2, "amount": 800.0},
    {"customerId": 3, "amount": 900.0},
    {"customerId": 4, "amount": 500.0}
]
```

### API Endpoints
```bash
# Save data
POST http://localhost:8080/api/orders/save-all

# Query method test
GET http://localhost:8080/api/orders/under-budget/800

# Expected response for budget=800:
# Returns orders with amount: 700, 800, 500 (but not 900)
```

---

### üéâ Congratulations Bhai! 
Ab tum Spring Data JPA mein Less Than or Equal operations ke expert ho gaye! Practice karte raho aur real projects mein implement karo! üí™

**Happy Coding! üöÄ**
